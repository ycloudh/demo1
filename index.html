<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>响应式计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#FF7D00',
                        dark: '#1E1E1E',
                        light: '#F5F5F5',
                        'gray-light': '#E0E0E0',
                        'gray-medium': '#9E9E9E',
                        'gray-dark': '#616161'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .calculator-shadow {
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            }
            .btn-hover {
                transition: all 0.15s ease;
            }
            .btn-hover:hover {
                transform: scale(0.98);
            }
            .btn-hover:active {
                transform: scale(0.95);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4 font-sans">
    <div class="max-w-md w-full">
        <!-- 计算器标题 -->
        <div class="text-center mb-6">
            <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-gray-800">高级计算器</h1>
            <p class="text-gray-600">简洁、高效的计算工具</p>
        </div>
        
        <!-- 计算器主体 -->
        <div class="bg-white rounded-2xl calculator-shadow overflow-hidden">
            <!-- 显示区域 -->
            <div class="bg-dark p-6 text-right">
                <div id="calculator-history" class="text-gray-medium text-lg mb-2 min-h-[24px] overflow-hidden text-ellipsis"></div>
                <div id="calculator-display" class="text-white text-[clamp(2rem,5vw,3rem)] font-light min-h-[48px] overflow-x-auto"></div>
            </div>
            
            <!-- 按钮区域 -->
            <div class="p-4 grid grid-cols-4 gap-3">
                <!-- 第一行 -->
                <button class="calc-btn bg-gray-light text-gray-dark rounded-xl p-4 text-xl font-medium btn-hover" data-value="C">C</button>
                <button class="calc-btn bg-gray-light text-gray-dark rounded-xl p-4 text-xl font-medium btn-hover" data-value="±">±</button>
                <button class="calc-btn bg-gray-light text-gray-dark rounded-xl p-4 text-xl font-medium btn-hover" data-value="%">%</button>
                <button class="calc-btn bg-secondary text-white rounded-xl p-4 text-xl font-medium btn-hover" data-value="/">÷</button>
                
                <!-- 第二行 -->
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="7">7</button>
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="8">8</button>
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="9">9</button>
                <button class="calc-btn bg-secondary text-white rounded-xl p-4 text-xl font-medium btn-hover" data-value="*">×</button>
                
                <!-- 第三行 -->
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="4">4</button>
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="5">5</button>
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="6">6</button>
                <button class="calc-btn bg-secondary text-white rounded-xl p-4 text-xl font-medium btn-hover" data-value="-">-</button>
                
                <!-- 第四行 -->
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="1">1</button>
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="2">2</button>
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value="3">3</button>
                <button class="calc-btn bg-secondary text-white rounded-xl p-4 text-xl font-medium btn-hover" data-value="+">+</button>
                
                <!-- 第五行 -->
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover col-span-2" data-value="0">0</button>
                <button class="calc-btn bg-light text-gray-800 rounded-xl p-4 text-xl font-medium btn-hover" data-value=".">.</button>
                <button class="calc-btn bg-primary text-white rounded-xl p-4 text-xl font-medium btn-hover" data-value="=">=</button>
            </div>
        </div>
        
        <!-- 功能说明 -->
        <div class="mt-6 text-center text-gray-600 text-sm">
            <p>支持基本运算、百分比计算和正负转换</p>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const display = document.getElementById('calculator-display');
        const history = document.getElementById('calculator-history');
        const buttons = document.querySelectorAll('.calc-btn');
        
        // 计算器状态
        let currentValue = '0';
        let previousValue = '';
        let operator = null;
        let resetOnNextInput = false;
        
        // 更新显示
        function updateDisplay() {
            // 格式化数字显示，添加千位分隔符
            if (!isNaN(currentValue) && currentValue !== '') {
                let formattedValue = parseFloat(currentValue).toLocaleString('zh-CN', {
                    maximumFractionDigits: 10
                });
                // 保留小数点后的末尾零
                if (currentValue.includes('.')) {
                    const decimalPart = currentValue.split('.')[1];
                    if (decimalPart) {
                        formattedValue += '.' + decimalPart.replace(/0+$/, '');
                        if (formattedValue.endsWith('.')) {
                            formattedValue += '0';
                        }
                    }
                }
                display.textContent = formattedValue;
            } else {
                display.textContent = currentValue;
            }
            
            // 更新历史记录
            if (previousValue && operator) {
                let formattedOperator = operator;
                switch(operator) {
                    case '/': formattedOperator = '÷'; break;
                    case '*': formattedOperator = '×'; break;
                }
                history.textContent = `${previousValue} ${formattedOperator}`;
            } else {
                history.textContent = '';
            }
        }
        
        // 初始化显示
        updateDisplay();
        
        // 处理按钮点击
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const value = button.getAttribute('data-value');
                
                // 数字和小数点
                if (!isNaN(value) || value === '.') {
                    handleNumber(value);
                } 
                // 运算符
                else if (['+', '-', '*', '/', '='].includes(value)) {
                    handleOperator(value);
                } 
                // 特殊功能
                else if (value === 'C') {
                    clearAll();
                } else if (value === '±') {
                    toggleSign();
                } else if (value === '%') {
                    calculatePercentage();
                }
                
                updateDisplay();
            });
        });
        
        // 处理数字输入
        function handleNumber(value) {
            // 如果需要重置，清空当前值
            if (resetOnNextInput) {
                currentValue = '0';
                resetOnNextInput = false;
            }
            
            // 处理小数点
            if (value === '.') {
                if (!currentValue.includes('.')) {
                    currentValue += '.';
                }
                return;
            }
            
            // 处理数字
            if (currentValue === '0') {
                currentValue = value;
            } else {
                // 限制最大长度
                if (currentValue.length < 15) {
                    currentValue += value;
                }
            }
        }
        
        // 处理运算符
        function handleOperator(value) {
            // 如果已经有运算符，先计算结果
            if (operator && previousValue && !resetOnNextInput) {
                calculateResult();
            }
            
            // 如果是等于号，不设置新的运算符
            if (value !== '=') {
                operator = value;
                previousValue = currentValue;
                resetOnNextInput = true;
            } else {
                // 等于号后，准备新的计算
                previousValue = '';
                operator = null;
                resetOnNextInput = true;
            }
        }
        
        // 计算结果
        function calculateResult() {
            const prev = parseFloat(previousValue);
            const curr = parseFloat(currentValue);
            let result;
            
            switch(operator) {
                case '+':
                    result = prev + curr;
                    break;
                case '-':
                    result = prev - curr;
                    break;
                case '*':
                    result = prev * curr;
                    break;
                case '/':
                    if (curr === 0) {
                        currentValue = '错误';
                        return;
                    }
                    result = prev / curr;
                    break;
                default:
                    return;
            }
            
            // 限制结果的精度
            currentValue = result.toString();
            if (currentValue.length > 15) {
                currentValue = parseFloat(result).toFixed(10);
                // 移除末尾的零
                currentValue = currentValue.replace(/0+$/, '').replace(/\.$/, '');
            }
        }
        
        // 清除所有
        function clearAll() {
            currentValue = '0';
            previousValue = '';
            operator = null;
            resetOnNextInput = false;
        }
        
        // 切换正负号
        function toggleSign() {
            if (currentValue !== '0' && currentValue !== '错误') {
                currentValue = (parseFloat(currentValue) * -1).toString();
            }
        }
        
        // 计算百分比
        function calculatePercentage() {
            currentValue = (parseFloat(currentValue) / 100).toString();
        }
        
        // 键盘支持
        document.addEventListener('keydown', (e) => {
            // 数字键
            if (/[0-9]/.test(e.key)) {
                handleNumber(e.key);
            }
            // 小数点
            else if (e.key === '.') {
                handleNumber('.');
            }
            // 运算符
            else if (['+', '-', '*', '/'].includes(e.key)) {
                handleOperator(e.key);
            }
            // 等于
            else if (e.key === '=' || e.key === 'Enter') {
                e.preventDefault();
                handleOperator('=');
            }
            // 清除
            else if (e.key === 'Escape') {
                clearAll();
            }
            // 退格
            else if (e.key === 'Backspace') {
                e.preventDefault();
                if (currentValue.length > 1 && currentValue !== '错误') {
                    currentValue = currentValue.slice(0, -1);
                } else {
                    currentValue = '0';
                }
            }
            
            updateDisplay();
        });
    </script>
</body>
</html>
    